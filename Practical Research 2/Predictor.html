<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Pechay Predictor — Prediction</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>
	<script src="detector.js"></script> <!-- add detector utilities -->
	<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
	<style>
		body {
			font-family: "Segoe UI", sans-serif;
			background: #f8fff8;
			margin: 0;
			padding: 20px;
			color: #0f172a;
		}
		.card {
			background: white;
			border-radius: 20px;
			box-shadow: 0 6px 20px rgba(0,0,0,0.1);
			padding: 30px;
			max-width: 900px;
			margin: auto;
		}
		h1 {
			text-align: center;
			color: #27ae60;
			margin-bottom: 10px;
		}
		h2 {
			margin-top: 20px;
			color: #14532d;
		}
		label {
			font-weight: bold;
			color: #14532d;
		}
		select {
			width: 100%;
			padding: 10px;
			border: 1px solid #ccc;
			border-radius: 10px;
			font-size: 1rem;
			margin-top: 8px;
		}
		.grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 20px;
			margin-top: 20px;
			align-items: start;
		}
		.subtitle {
			text-align: center;
			color: #219150;
			font-size: 1.13em;
			margin-bottom: 18px;
		}
		.section {
			margin: 22px 0 0 0;
			padding-bottom: 8px;
			border-bottom: 1.5px solid #e0f2e9;
		}
		.values {
			background: linear-gradient(90deg, #e0fbe6 60%, #f0fff4 100%);
			padding: 18px 18px 10px 18px;
			border-radius: 14px;
			box-shadow: 0 2px 10px rgba(39,174,96,0.07);
			font-size: 1.08em;
			margin-bottom: 10px;
			transition: box-shadow 0.2s;
		}
		.values p {
			margin: 10px 0;
			font-size: 1.08em;
		}
		.values strong {
			color: #27ae60;
			font-weight: bold;
		}
		.growth-tip {
			background: #fffbe6;
			border-left: 5px solid #f7c948;
			border-radius: 10px;
			color: #b38600;
			padding: 10px 16px;
			margin-bottom: 8px;
			font-size: 1.01em;
			box-shadow: 0 1px 6px rgba(247,201,72,0.07);
			animation: fadeIn 0.7s;
		}
		.plant-img {
			text-align: center;
			margin-top: 15px;
		}
		.plant-img img {
			max-width: 170px;
			border-radius: 12px;
			box-shadow: 0 2px 12px rgba(39,174,96,0.10);
			border: 2px solid #b2f2bb;
			background: #fff;
		}
		.img-caption {
			font-size: 0.98em;
			color: #219150;
			margin-top: 6px;
		}
		canvas {
			margin-top: 10px;
			max-height: 320px;
			background: #f8fff8;
			border-radius: 10px;
			box-shadow: 0 2px 10px rgba(39,174,96,0.06);
		}
		.about {
			margin-top: 30px;
			padding: 22px 18px 18px 18px;
			background: linear-gradient(90deg, #f0fff4 60%, #e0fbe6 100%);
			border-left: 6px solid #27ae60;
			border-radius: 14px;
			box-shadow: 0 2px 10px rgba(39,174,96,0.07);
		}
		.about h3 {
			margin-top: 0;
			color: #219150;
		}
		.learn-btn {
			background: #27ae60;
			color: white;
			padding: 12px 24px;
			border: none;
			border-radius: 12px;
			cursor: pointer;
			font-weight: bold;
			font-size: 1.08em;
			margin-top: 12px;
			box-shadow: 0 2px 8px rgba(39,174,96,0.10);
			transition: background 0.2s;
		}
		.learn-btn:hover {
			background: #219150;
		}
		.user-greeting {
			margin: 12px 0 0 0;
			font-size: 1.09em;
			color: #219150;
			text-align: center;
			font-weight: bold;
		}
		.theme-switcher {
			position: fixed;
			top: 18px;
			right: 18px;
			z-index: 100;
			background: #fff;
			border-radius: 8px;
			box-shadow: 0 2px 8px rgba(44,62,80,0.08);
			padding: 8px 14px;
			font-size: 1em;
			cursor: pointer;
			border: 1px solid #27ae60;
			color: #219150;
			transition: background 0.2s;
		}
		.theme-switcher:hover {
			background: #eafaf1;
		}
		.feedback-btn {
			position: fixed;
			bottom: 30px;
			right: 30px;
			z-index: 100;
			background: #27ae60;
			color: #fff;
			border-radius: 50px;
			padding: 14px 22px;
			font-size: 1.08em;
			box-shadow: 0 2px 12px rgba(39,174,96,0.18);
			border: none;
			cursor: pointer;
			font-weight: bold;
			transition: background 0.2s;
		}
		.feedback-btn:hover {
			background: #219150;
		}
		@keyframes fadeIn {
			from { opacity: 0; transform: translateY(20px); }
			to { opacity: 1; transform: translateY(0); }
		}
		.animated {
			animation: fadeIn 0.7s;
		}
		.main-header {
			background: #26ab3a;
			color: #fff;
			padding: 1.2rem;
			text-align: center;
			border-bottom-left-radius: 30px;
			border-bottom-right-radius: 30px;
			box-shadow: 0 4px 15px rgba(0,0,0,0.10);
			margin-bottom: 0;
		}
		.main-nav {
			background: #34495e;
			padding: 0.7rem 0;
			text-align: center;
			margin: 0 0 18px 0;
			box-shadow: 0 2px 8px rgba(44, 62, 80, 0.07);
		}
		.main-nav ul {
			list-style: none;
			margin: 0;
			padding: 0;
			display: flex;
			justify-content: center;
			gap: 32px;
		}
		.main-nav ul li {
			display: inline-block;
		}
		.main-nav ul li a {
			color: white;
			text-decoration: none;
			font-weight: bold;
			font-size: 1.05rem;
			padding: 7px 16px;
			border-radius: 6px;
			transition: background 0.2s, color 0.2s;
			display: inline-block;
		}
		.main-nav ul li a:hover,
		.main-nav ul li a.active {
			color: #27ae60;
			background: #eafaf1;
			text-decoration: none;
		}
		.back-btn {
			display: inline-block;
			margin: 18px auto 0 auto;
			background: #219150;
			color: #fff;
			padding: 8px 20px;
			border-radius: 8px;
			font-weight: bold;
			text-decoration: none;
			box-shadow: 0 2px 8px rgba(33,145,80,0.10);
			transition: background 0.2s;
			border: none;
			cursor: pointer;
		}
		.back-btn:hover {
			background: #27ae60;
		}
		.footer {
			margin-top: 40px;
			background: #2c3e50;
			color: white;
			text-align: center;
			padding: 1rem;
			border-top-left-radius: 20px;
			border-top-right-radius: 20px;
		}
		:root {
			--site-bg-url: none;
			--site-bg-overlay: rgba(168,230,207,0.55);
		}
		body.has-site-bg {
			background-image: linear-gradient(var(--site-bg-overlay), var(--site-bg-overlay)), var(--site-bg-url);
			background-size: cover;
			background-position: center center;
			background-repeat: no-repeat;
		}
		@media (max-width: 700px) {
			.card {
				padding: 10px;
				margin: 10px;
			}
			.main-header {
				font-size: 1.1em;
				padding: 0.8rem;
			}
			.main-nav ul {
				gap: 10px;
			}
		}

		/* New styles for result display and loading states */
		.result-card {
			padding: 18px;
			border-radius: 12px;
			box-shadow: 0 4px 16px rgba(0,0,0,0.12);
			margin-top: 12px;
			background: linear-gradient(145deg, #ffffff, #f9f9f9);
		}
		.loader {
			border: 4px solid #f3f3f3;
			border-top: 4px solid #3498db;
			border-radius: 50%;
			width: 24px;
			height: 24px;
			animation: spin 1s linear infinite;
			margin: 0 auto;
		}
		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}
		.glass-card {
			background: rgba(255, 255, 255, 0.8);
			backdrop-filter: blur(10px);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}
		.value-display {
			font-size: 1.2em;
			font-weight: bold;
			margin-bottom: 8px;
			text-align: center;
		}

		/* Detailed results styles */
		.detailed-result {
			padding: 20px;
			border-radius: 12px;
			background: #ffffff;
			box-shadow: 0 4px 16px rgba(0,0,0,0.12);
			margin-top: 18px;
		}
		.metric-group {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 12px;
		}
		.metric-value {
			font-size: 1.5em;
			font-weight: bold;
			color: #27ae60;
		}
		.metric-label {
			font-size: 0.9em;
			color: #555;
			margin-top: 4px;
		}
		.accuracy-meter {
			width: 100%;
			height: 8px;
			background: #e0e0e0;
			border-radius: 4px;
			overflow: hidden;
			margin-left: 12px;
			flex-grow: 1;
		}
		.accuracy-fill {
			height: 100%;
			background: #27ae60;
			transition: width 0.3s;
		}
		.tooltip {
			position: relative;
			display: inline-block;
		}
		.tooltip-text {
			visibility: hidden;
			width: 220px;
			background-color: #555;
			color: #fff;
			text-align: center;
			border-radius: 6px;
			padding: 5px 10px;
			position: absolute;
			z-index: 1;
			bottom: 125%; /* Position above the tooltip element */
			left: 50%;
			margin-left: -110px; /* Center the tooltip */
			opacity: 0;
			transition: opacity 0.3s;
		}
		.tooltip:hover .tooltip-text {
			visibility: visible;
			opacity: 1;
		}

		/* Chart controls */
		.chart-controls {
			display: flex;
			justify-content: center;
			gap: 12px;
			margin: 18px 0;
		}
		.modern-btn {
			background: #27ae60;
			color: white;
			padding: 10px 18px;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-weight: bold;
			font-size: 1em;
			box-shadow: 0 2px 8px rgba(39,174,96,0.10);
			transition: background 0.2s;
		}
		.modern-btn:hover {
			background: #219150;
		}

		model-viewer {
			width: 100%;
			height: 400px;
			margin: 20px 0;
			background-color: #f8fff8;
			border-radius: 15px;
			--poster-color: transparent;
		}
		.ar-controls {
			display: flex;
			gap: 10px;
			margin: 10px 0;
			justify-content: center;
		}
	</style>
</head>
<body>
	<header class="main-header">
		<h1>Pechay Growth Scanner</h1>
		<p>Scan and Predict Pechay Growth</p>
	</header>
	<nav class="main-nav">
		<ul>
			<li><a href="Main Website.html">Main</a></li>
			<li><a href="Main Website.html">Pechay Predictor</a></li>
			<li><a href="Scanner.html" class="active">Scan Pechay</a></li>
			<li><a href="pechay-scanner.html">Growth Articles</a></li>
		</ul>
	</nav>
	<button class="theme-switcher" id="themeSwitcher" aria-label="Switch theme">🌗 Theme</button>
	<button class="feedback-btn" onclick="showFeedbackModal()" aria-label="Send feedback">💬 Feedback</button>
	<!-- Feedback Modal -->
	<div id="feedbackModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);z-index:999;">
		<div style="background:#fff;max-width:340px;margin:80px auto;padding:24px 18px;border-radius:14px;box-shadow:0 4px 18px rgba(0,0,0,0.13);position:relative;">
			<h3 style="color:#219150;margin-top:0;">Send Feedback</h3>
			<label for="feedbackEmail" style="font-weight:bold;">Your Email (optional):</label>
			<input id="feedbackEmail" type="email" style="width:100%;margin-bottom:10px;padding:7px;border-radius:6px;border:1px solid #27ae60;">
			<label for="feedbackMsg" style="font-weight:bold;">Your Feedback:</label>
			<textarea id="feedbackMsg" rows="4" style="width:100%;margin-bottom:10px;padding:7px;border-radius:6px;border:1px solid #27ae60;"></textarea>
			<label style="display:block;margin-top:8px;"><input id="attachBgChkScanner" type="checkbox"> Attach current background image to feedback</label>
			<button id="feedbackSendBtn" style="background:#27ae60;color:white;padding:8px 18px;border-radius:8px;border:none;font-weight:bold;">Send</button>
			<button onclick="closeFeedbackModal()" style="background:#eee;color:#219150;padding:8px 14px;border-radius:8px;border:none;font-weight:bold;margin-left:8px;">Cancel</button>
			<div id="feedbackStatus" style="margin-top:10px;color:#219150;font-weight:bold;"></div>
		</div>
	</div>
	<div class="user-greeting" id="userGreeting"></div>
	<div style="text-align:center;margin-bottom:12px;">
		<label for="userNameInput" style="color:#219150;font-weight:bold;">Personalize: Enter your name</label>
		<input id="userNameInput" type="text" placeholder="Your name..." style="padding:6px 12px;border-radius:6px;border:1px solid #27ae60;margin-left:8px;">
		<button onclick="setUserName()" style="background:#27ae60;color:white;padding:6px 14px;border-radius:6px;border:none;font-weight:bold;margin-left:6px;">Save</button>
	</div>
	<div class="card" style="margin-top:20px;">
		<a href="Main Website.html" class="back-btn" style="float:right;margin-bottom:10px;">← Back to Pechay Predictor</a>
		<h1>Pechay Growth Prediction <span style="font-size:1.2em;">🌱</span></h1>
		<p class="subtitle">Visualize and predict Pechay growth in hydroponics using AI-powered regression models.</p>

		<div class="section">
			<h2>1. Select Day of Growth</h2>
			<select id="growthDay" onchange="predictGrowth()">
				<option value="">-- Choose a Day --</option>
				<option value="5">Day 5</option>
				<option value="10">Day 10</option>
				<option value="15">Day 15</option>
				<option value="20">Day 20</option>
				<option value="25">Day 25</option>
				<option value="30">Day 30</option>
			</select>

			<!-- added: custom day input -->
			<div style="margin-top:10px;display:flex;gap:8px;align-items:center;">
				<label for="customDayInput" style="font-weight:bold;color:#14532d;margin-right:6px;">Or enter custom day:</label>
				<input id="customDayInput" type="number" min="1" max="365" step="1" placeholder="e.g. 12" style="padding:8px;border-radius:8px;border:1px solid #ccc;width:120px;">
				<button class="modern-btn" id="useCustomBtn" type="button" style="padding:8px 12px;">Apply</button>
			</div>
			<div id="dayError" style="color:#b71c1c;display:none;margin-top:8px;font-size:0.95em;"></div>
		</div>

		<div class="grid">
			<div>
				<h2>2. Predicted Values</h2>
				<div id="result" class="detailed-result slide-in" style="display:none;">
					<!-- Loading State -->
					<div id="loadingState" class="text-center" style="display:none;">
						<span class="loader"></span>
						<p>Computing predictions...</p>
					</div>
					<!-- Results State -->
					<div id="resultContent">
						<div class="metric-group">
							<div class="tooltip">
								<div class="metric-value updating" id="heightValue"></div>
								<div class="metric-label">Plant Height</div>
								<span class="tooltip-text">Predicted height based on growth day and environmental factors</span>
							</div>
							<div class="accuracy-meter">
								<div class="accuracy-fill" id="heightAccuracy"></div>
							</div>
						</div>
						<div class="metric-group">
							<div class="tooltip">
								<div class="metric-value" id="areaValue"></div>
								<div class="metric-label">Leaf Area</div>
								<span class="tooltip-text">Total surface area of all leaves</span>
							</div>
							<div class="accuracy-meter">
								<div class="accuracy-fill" id="areaAccuracy"></div>
							</div>
						</div>
						<div class="metric-group">
							<div class="tooltip">
								<div class="metric-value" id="leavesValue"></div>
								<div class="metric-label">Number of Leaves</div>
								<span class="tooltip-text">Predicted total leaf count</span>
							</div>
							<div class="accuracy-meter">
								<div class="accuracy-fill" id="leavesAccuracy"></div>
							</div>
						</div>
					</div>
					
					<!-- Add new AR link button -->
					<div style="text-align: center; margin-top: 20px;">
						<a href="https://melkywayy-19.github.io/PechayAR/?fbclid=IwY2xjawNnv2pleHRuA2FlbQIxMABicmlkETFjMU1wNHlBeDh4VklPT0hzAR5hilxpy02RCpE2XA-JvC1mtLKCViZduBGdw4pjs4CLZ5OrWix67VW0jETa5g_aem_D50N118ftpT-9ZbFxFVD0A" 
						   class="modern-btn" 
						   target="_blank" 
						   style="text-decoration: none; display: inline-block;">
							🔍 View in Advanced AR
						</a>
					</div>
				</div>

				<!-- Added: AR model viewer shown right after results -->
				<div id="arContainer" style="margin-top:14px;display:none;">
					<model-viewer
						id="modelPreview"
						src="models/pechay.glb"
						ios-src="models/pechay.usdz"
						alt="3D Pechay model"
						camera-controls
						environment-image="neutral"
						loading="auto"
						style="width:100%;height:380px;border-radius:12px;background:#f8fff8;"
						></model-viewer>

					<div class="ar-controls" style="justify-content:center;margin-top:8px;">
						<button class="modern-btn" id="openArBtn" type="button">Open AR</button>
						<button class="modern-btn" id="hideModelBtn" type="button" style="background:#eee;color:#219150;">Hide Model</button>
					</div>
				</div>

				<div class="about" style="margin-top:14px;">
					<h3>Model details</h3>
					<p><strong>Plant Height (cm)</strong> — Quadratic: y = 0.0262x² + 0.6066x + 0.9952</p>
					<p><strong>Leaf Area (cm²)</strong> — Cubic: y = -0.00023x³ + 0.0797x² + 0.4225x + 0.8551</p>
					<p><strong>No. of Leaves</strong> — Quadratic: y = 0.0066x² + 0.3511x + 1.5099</p>
				</div>
			</div>

			<div>
				<h2>3. Visualization</h2>
				<div class="result-card glass-card" id="quickSummary" style="display:none;">
					<div class="value-display" id="summaryLine">Predictions will appear here after selecting a day.</div>
					<div style="display:flex;gap:12px;justify-content:center;">
						<button class="modern-btn" onclick="copySummary()">Copy Summary</button>
						<button class="modern-btn" onclick="resetSelection()">Reset</button>
					</div>
				</div>

				<!-- removed old model-viewer placeholder from here -->
			</div>
		</div>

		<footer class="footer">
			<p>© Pechay Growth Predictor</p>
		</footer>
	</div>

	<script>
		// Prediction and UI functions
		const resultEl = document.getElementById('result');
		const loadingState = document.getElementById('loadingState');
		const summaryLine = document.getElementById('summaryLine');
		const heightValue = document.getElementById('heightValue');
		const areaValue = document.getElementById('areaValue');
		const leavesValue = document.getElementById('leavesValue');
		const heightAccuracy = document.getElementById('heightAccuracy');
		const areaAccuracy = document.getElementById('areaAccuracy');
		const leavesAccuracy = document.getElementById('leavesAccuracy');

		// small helper: determine chosen day (custom preferred)
		function getChosenDay() {
			const customEl = document.getElementById('customDayInput');
			const selEl = document.getElementById('growthDay');
			const dayError = document.getElementById('dayError');

			dayError.style.display = 'none';
			dayError.textContent = '';

			const customVal = customEl && customEl.value ? Number(customEl.value) : NaN;
			if (!isNaN(customVal) && customVal !== 0) {
				// validate range
				if (customVal < 1 || customVal > 365) {
					dayError.style.display = 'block';
					dayError.textContent = 'Please enter a day between 1 and 365.';
					return null;
				}
				return customVal;
			}

			const selVal = selEl && selEl.value ? Number(selEl.value) : NaN;
			if (!isNaN(selVal) && selVal !== 0) return selVal;

			dayError.style.display = 'block';
			dayError.textContent = 'Select a preset day or enter a custom day (1–365).';
			return null;
		}

		function predictGrowth() {
			const x = getChosenDay();
			if (x === null) {
				// invalid or not chosen
				resultEl.style.display = 'none';
				document.getElementById('quickSummary').style.display = 'none';
				// hide AR viewer if present
				if (arContainer) arContainer.style.display = 'none';
				return;
			}

			// show result panel + loader
			resultEl.style.display = 'block';
			loadingState.style.display = 'block';
			document.getElementById('resultContent').style.opacity = '0.4';

			// simulate compute delay
			setTimeout(() => {
				// Equations from provided models:
				// Plant Height (quadratic): y = 0.0262x^2 + 0.6066x + 0.9952
				const height = (0.0262 * x * x) + (0.6066 * x) + 0.9952;

				// Leaf Area (cubic): y = -0.00023x^3 + 0.0797x^2 + 0.4225x + 0.8551
				const area = (-0.00023 * x * x * x) + (0.0797 * x * x) + (0.4225 * x) + 0.8551;

				// Number of Leaves (quadratic): y = 0.0066x^2 + 0.3511x + 1.5099
				const leaves = (0.0066 * x * x) + (0.3511 * x) + 1.5099;

				// format and display
				heightValue.textContent = height.toFixed(2) + ' cm';
				areaValue.textContent = area.toFixed(2) + ' cm²';
				leavesValue.textContent = Math.max(0, Math.round(leaves)) + ' leaves';

				// simple, illustrative "accuracy" meters (not true model metrics)
				const hAcc = Math.min(98, Math.round(40 + x * 1.6)); // grows with x
				const aAcc = Math.min(98, Math.round(35 + x * 1.8));
				const lAcc = Math.min(98, Math.round(30 + x * 1.2));

				heightAccuracy.style.width = hAcc + '%';
				areaAccuracy.style.width = aAcc + '%';
				leavesAccuracy.style.width = lAcc + '%';

				// update summary
				summaryLine.textContent = `Day ${x}: Height ${height.toFixed(2)} cm · Leaf area ${area.toFixed(2)} cm² · ${Math.round(leaves)} leaves`;
				document.getElementById('quickSummary').style.display = 'block';

				// show AR model viewer (use local model paths by default)
				if (modelPreview && arContainer) {
					// ensure src/ios-src are set (developer: place models at models/pechay.glb and models/pechay.usdz)
					if (!modelPreview.getAttribute('src')) modelPreview.setAttribute('src','models/pechay.glb');
					if (!modelPreview.getAttribute('ios-src')) modelPreview.setAttribute('ios-src','models/pechay.usdz');

					// optionally adjust camera-orbit (a tiny zoom based on height)
					const orbitRadius = Math.min(3.0, Math.max(1.2, 1.2 + height/40));
					modelPreview.setAttribute('camera-orbit', `45deg 75deg ${orbitRadius}m`);

					arContainer.style.display = 'block';
				}

				// hide loader
				loadingState.style.display = 'none';
				document.getElementById('resultContent').style.opacity = '1';
			}, 600);
		}

		function copySummary() {
			if (!summaryLine) return;
			navigator.clipboard?.writeText(summaryLine.textContent || '').then(() => {
				alert('Summary copied to clipboard');
			}).catch(() => {
				alert('Copy failed');
			});
		}

		function resetSelection() {
			document.getElementById('growthDay').value = '';
			const c = document.getElementById('customDayInput');
			if (c) c.value = '';
			const dayError = document.getElementById('dayError');
			if (dayError) { dayError.style.display = 'none'; dayError.textContent = ''; }
			resultEl.style.display = 'none';
			document.getElementById('quickSummary').style.display = 'none';
		}

		// small helpers: user name and theme + feedback modal
		function setUserName() {
			const name = document.getElementById('userNameInput').value.trim();
			const greeting = document.getElementById('userGreeting');
			if (name) {
				localStorage.setItem('pechay_user', name);
				greeting.textContent = 'Welcome, ' + name + ' 🌱';
			} else {
				localStorage.removeItem('pechay_user');
				greeting.textContent = '';
			}
		}
		(function loadUser() {
			const n = localStorage.getItem('pechay_user');
			if (n) document.getElementById('userGreeting').textContent = 'Welcome, ' + n + ' 🌱';
		})();

		document.getElementById('themeSwitcher').addEventListener('click', () => {
			document.body.classList.toggle('has-site-bg');
		});

		function showFeedbackModal() {
			document.getElementById('feedbackModal').style.display = 'block';
		}
		function closeFeedbackModal() {
			document.getElementById('feedbackModal').style.display = 'none';
			document.getElementById('feedbackStatus').textContent = '';
		}
		document.getElementById('feedbackSendBtn').addEventListener('click', () => {
			const email = document.getElementById('feedbackEmail').value;
			const msg = document.getElementById('feedbackMsg').value;
			const attach = document.getElementById('attachBgChkScanner').checked;
			// minimal fake send
			document.getElementById('feedbackStatus').textContent = 'Sending...';
			setTimeout(() => {
				document.getElementById('feedbackStatus').textContent = 'Thanks — feedback sent!';
				// reset after small delay
				setTimeout(closeFeedbackModal, 1100);
			}, 800);
			// (In real app: POST to your server with optional attachment)
		});

		// wire Apply button and Enter key on custom input
		document.getElementById('useCustomBtn').addEventListener('click', () => predictGrowth());
		document.getElementById('customDayInput').addEventListener('keydown', (e) => {
			if (e.key === 'Enter') predictGrowth();
		});

		const modelPreview = document.getElementById('modelPreview');
		const arContainer = document.getElementById('arContainer');
		const openArBtn = document.getElementById('openArBtn');
		const hideModelBtn = document.getElementById('hideModelBtn');

		// Open AR button: attempt to enter AR using model-viewer API
		if (openArBtn && modelPreview) {
			openArBtn.addEventListener('click', async () => {
				try {
					// model-viewer exposes enterAR() in supporting browsers/devices
					if (typeof modelPreview.enterAR === 'function') {
						await modelPreview.enterAR();
					} else {
						alert('AR not available on this device/browser. You can still view the 3D model on screen.');
					}
				} catch (e) {
					alert('Unable to enter AR: ' + (e.message || e));
				}
			});
		}

		// hide model button
		if (hideModelBtn && arContainer) {
			hideModelBtn.addEventListener('click', () => { arContainer.style.display = 'none'; });
		}

        // Add Pechay Growth Checker functionality (converted from Java)
        function simulatePechayGrowth(days) {
            if (days < 1 || days > 365) {
                throw new Error("Invalid number of days! Please enter between 1 and 365.");
            }

            const height = new Array(days);
            const leafSize = new Array(days);
            const leaves = new Array(days);

            // starting values
            height[0] = 1.8;   // cm
            leafSize[0] = 1.2; // cm²
            leaves[0] = 2;     // leaves

            // simulate automatic growth
            for (let i = 1; i < days; i++) {
                height[i] = height[i - 1] + Math.random() * 0.4; // 0.0 - 0.4 cm per day
                leafSize[i] = leafSize[i - 1] + Math.random() * 0.6; // 0.0 - 0.6 cm² per day
                leaves[i] = leaves[i - 1];

                // add new leaf every 20 days (max 50)
                if (i % 20 === 0 && leaves[i] < 50) {
                    leaves[i]++;
                }
            }

            // Calculate summary
            const totalGrowth = height[days - 1] - height[0];
            let avgHeight = 0, avgLeafSize = 0;
            let totalLeaves = 0;

            for (let i = 0; i < days; i++) {
                avgHeight += height[i];
                avgLeafSize += leafSize[i];
                totalLeaves += leaves[i];
            }

            avgHeight /= days;
            avgLeafSize /= days;
            const avgLeaves = totalLeaves / days;

            return {
                history: {
                    height,
                    leafSize,
                    leaves
                },
                summary: {
                    initialHeight: height[0],
                    finalHeight: height[days - 1],
                    totalGrowth,
                    avgHeight,
                    avgLeafSize,
                    avgLeaves,
                    status: "The Pechay plant shows healthy and consistent growth!"
                }
            };
        }

        // Enhance predictGrowth function to include simulation
        const originalPredictGrowth = predictGrowth;
        predictGrowth = function() {
            const x = getChosenDay();
            if (x === null) return;

            // Run original prediction
            originalPredictGrowth();

            // Add simulation results
            try {
                const simulation = simulatePechayGrowth(x);
                
                // Add simulation results to the display
                const simResultsDiv = document.createElement('div');
                simResultsDiv.className = 'about';
                simResultsDiv.style.marginTop = '20px';
                simResultsDiv.innerHTML = `
                    <h3>Detailed Growth Simulation</h3>
                    <p><strong>Initial Height:</strong> ${simulation.summary.initialHeight.toFixed(2)} cm</p>
                    <p><strong>Final Height:</strong> ${simulation.summary.finalHeight.toFixed(2)} cm</p>
                    <p><strong>Total Growth:</strong> ${simulation.summary.totalGrowth.toFixed(2)} cm</p>
                    <p><strong>Average Height:</strong> ${simulation.summary.avgHeight.toFixed(2)} cm</p>
                    <p><strong>Average Leaf Size:</strong> ${simulation.summary.avgLeafSize.toFixed(2)} cm²</p>
                    <p><strong>Average Leaves:</strong> ${simulation.summary.avgLeaves.toFixed(1)}</p>
                    <p style="color: #27ae60;font-weight: bold;">${simulation.summary.status}</p>
                `;

                // Find where to insert the simulation results
                const resultContainer = document.getElementById('result');
                if (resultContainer) {
                    // Remove any existing simulation results
                    const existingSimResults = resultContainer.querySelector('.simulation-results');
                    if (existingSimResults) existingSimResults.remove();
                    
                    // Add new simulation results
                    simResultsDiv.className += ' simulation-results';
                    resultContainer.appendChild(simResultsDiv);
                }
            } catch (e) {
                console.error('Simulation error:', e);
            }
        };
    </script>
</body>
</html>